<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Food Chain Simulator</title>
    <style>
        /* CSS Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            color: #0056b3;
            text-align: center;
        }
        .food-chain-diagram {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: bold;
            color: #4CAF50;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        .container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }
        #controls, #trends {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        .instruction {
            font-style: italic;
            color: #666;
        }
        .level {
            margin-bottom: 25px; 
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .level h3 {
            margin-top: 0;
            color: #0056b3;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .buttons button {
            padding: 8px 12px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .buttons .increase {
            background-color: #4CAF50; 
            color: white;
        }
        .buttons .decrease {
            background-color: #f44336; 
            color: white;
        }
        /* --- Trend Display Styles --- */
        #trend-display p {
            font-size: 1.1em;
            padding: 8px;
            margin: 5px 0;
            border-left: 5px solid #0056b3;
            background-color: #e6f7ff;
            display: flex; 
            align-items: center;
            justify-content: space-between; 
        }
        #trend-display strong.up { color: green; }
        #trend-display strong.down { color: red; }
        #trend-display strong.organism { color: #0056b3; }

        /* --- Visual Bars --- */
        .population-meter {
            width: 50%; 
            height: 15px;
            background-color: #ccc;
            border-radius: 3px;
            overflow: hidden;
            border: 1px solid #999;
            flex-shrink: 0; 
        }
        .bar {
            height: 100%;
            background-color: #2196F3; 
            transition: width 0.5s ease-in-out;
        }
        
        /* --- Bottom Section --- */
        #bottom-controls {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        #brainteaser-button {
            background-color: #FF9800;
            color: white;
            padding: 12px 20px;
            font-size: 1.2em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .question-box {
            padding: 15px;
            background-color: #fff3e0;
            border: 1px solid #ffcc80;
            border-radius: 5px;
            margin-top: 15px;
            text-align: left;
        }
        #learn-more-button {
            background-color: #00BCD4;
            color: white;
            padding: 10px 15px;
            margin-top: 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        #trends button {
            display: block;
            width: 100%;
            margin-top: 10px;
            padding: 10px 12px; 
            background-color: #9E9E9E;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Visual Food Chain Simulator</h1>
    <div class="food-chain-diagram">
        Producer (Grass) &longrightarrow; Primary Consumer (Rabbit) &longrightarrow; Secondary Consumer (Fox)
    </div>

    <div class="container">
        <div id="controls">
            <h2>Ecosystem Controls</h2>
            <p class="instruction">Click a button to change a population.</p>
            <div id="population-status"></div>
        </div>

        <div id="trends">
            <div id="trend-display"></div>
            <button onclick="resetSimulation()">Reset Simulation</button>
        </div>
    </div>

    <div id="bottom-controls">
        <button id="brainteaser-button" onclick="showBrainteaser()">Brainteaser: Why are the bars different sizes?</button>
        <div id="brainteaser-output"></div>
    </div>
    
    <script>
        const LEVELS = ['Producer', 'Primary Consumer', 'Secondary Consumer'];
        const ORGANISMS = { 'Producer': 'Grass', 'Primary Consumer': 'Rabbit', 'Secondary Consumer': 'Fox' };
        let populations = { 'Producer': 70, 'Primary Consumer': 50, 'Secondary Consumer': 30 };
        
        const MAX_POPULATION = 100;
        const CLICK_SIZE = 10;
        const CASCADE_SIZE = 5;

        function renderStatus() {
            const statusDiv = document.getElementById('population-status');
            statusDiv.innerHTML = '';
            LEVELS.forEach(level => {
                const div = document.createElement('div');
                div.className = 'level';
                div.innerHTML = `
                    <h3>${level} (${ORGANISMS[level]})</h3>
                    <div class="buttons">
                        <button class="increase" onclick="userChangePopulation('${level}', ${CLICK_SIZE})">Increase</button>
                        <button class="decrease" onclick="userChangePopulation('${level}', -${CLICK_SIZE})">Decrease</button>
                    </div>
                `;
                statusDiv.appendChild(div);
            });
            displayCurrentTrends();
        }

        function userChangePopulation(level, delta) {
            populations[level] = Math.max(0, Math.min(MAX_POPULATION, populations[level] + delta)); 
            calculateAndApplyCascade(level, delta); 
        }

        function calculateAndApplyCascade(changedLevel, delta) {
            const trendDiv = document.getElementById('trend-display');
            trendDiv.innerHTML = '<h2>Ecosystem Effects:</h2>'; 
            const changedIndex = LEVELS.indexOf(changedLevel);
            const changeDirection = delta > 0 ? 1 : -1;
            const results = [];

            LEVELS.forEach(level => {
                let trend = 'is stable';
                let reason = 'Stable';
                let trendClass = 'stable';
                let targetIndex = LEVELS.indexOf(level);

                if (level === changedLevel) {
                    const action = delta > 0 ? 'increases' : 'decreases';
                    results[targetIndex] = { level, trend: action, reason: 'Manually changed', trendClass: action === 'increases' ? 'up' : 'down' };
                    return; 
                }

                const difference = targetIndex - changedIndex; 
                let effectDirection = 0;

                if (difference > 0) { 
                    effectDirection = changeDirection;
                    reason = changeDirection > 0 ? "More Food" : "Less Food";
                } else if (difference < 0) {
                    if (Math.abs(difference) % 2 === 1) { 
                        effectDirection = -changeDirection;
                        reason = effectDirection > 0 ? "Fewer Predators" : "More Predators";
                    } else { 
                        effectDirection = changeDirection;
                        reason = effectDirection > 0 ? "Indirect Effect" : "Indirect Effect";
                    }
                }

                if (effectDirection !== 0) {
                    populations[level] = Math.max(0, Math.min(MAX_POPULATION, populations[level] + (effectDirection * CASCADE_SIZE)));
                    trend = effectDirection > 0 ? 'increases' : 'decreases';
                    trendClass = effectDirection > 0 ? 'up' : 'down';
                }
                results[targetIndex] = { level, trend, reason, trendClass };
            });

            results.forEach(result => {
                const p = document.createElement('p');
                const organismName = `<strong class="organism">${result.level.toLowerCase()}</strong>`;
                let sentence = result.reason === 'Manually changed' ? 
                    `The number of ${organismName} was manually <strong class="${result.trendClass}">${result.trend}</strong>.` :
                    `The number of ${organismName} <strong class="${result.trendClass}">${result.trend}</strong>.`;

                p.innerHTML = `<span>${sentence}<br><small>Reason: ${result.reason}</small></span>
                    <div class="population-meter"><div class="bar" style="width: ${(populations[result.level]/MAX_POPULATION)*100}%;"></div></div>`;
                trendDiv.appendChild(p);
            });
        }
        
        function displayCurrentTrends() {
             const trendDiv = document.getElementById('trend-display');
             trendDiv.innerHTML = '<h2>Initial Population Status:</h2>';
             LEVELS.forEach(level => {
                const p = document.createElement('p');
                p.innerHTML = `<span>The number of <strong class="organism">${level.toLowerCase()}</strong> is <strong class="stable">stable</strong></span>
                    <div class="population-meter"><div class="bar" style="width: ${(populations[level]/MAX_POPULATION)*100}%;"></div></div>`;
                trendDiv.appendChild(p);
             });
        }

        function show

