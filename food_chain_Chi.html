<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦–è¦ºåŒ–é£Ÿç‰©éˆæ¨¡æ“¬å™¨ - ç”Ÿæ…‹ç³»çµ±å­¸ç¿’å·¥å…·</title>
    <style>
        /* CSS æ¨£å¼è¨­å®š */
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
        }
        h1 {
            color: #2e7d32;
            text-align: center;
        }
        .food-chain-diagram {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: bold;
            color: #2e7d32;
            padding: 15px;
            border: 3px dashed #81c784;
            border-radius: 10px;
            background-color: #e8f5e9;
        }
        .container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }
        #controls, #trends {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        .instruction {
            font-style: italic;
            color: #666;
            margin-bottom: 15px;
        }
        .level {
            margin-bottom: 25px; 
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .level h3 {
            margin-top: 0;
            color: #1b5e20;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .buttons button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        .buttons .increase {
            background-color: #4CAF50; 
            color: white;
        }
        .buttons .decrease {
            background-color: #f44336; 
            color: white;
        }
        /* è¶¨å‹¢é¡¯ç¤ºæ¨£å¼ */
        #trend-display p {
            font-size: 1.1em;
            padding: 10px;
            margin: 8px 0;
            border-left: 5px solid #2196F3;
            background-color: #e3f2fd;
            display: flex; 
            flex-direction: column;
        }
        #trend-display strong.up { color: #2e7d32; }
        #trend-display strong.down { color: #d32f2f; }
        #trend-display strong.organism { color: #1565c0; }

        .population-meter {
            width: 100%; 
            height: 18px;
            background-color: #eee;
            border-radius: 9px;
            overflow: hidden;
            border: 1px solid #bbb;
            margin-top: 8px;
        }
        .bar {
            height: 100%;
            background-color: #4db6ac; 
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        /* åº•éƒ¨æ§åˆ¶å€ */
        #bottom-controls {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        #brainteaser-button {
            background-color: #ff9800;
            color: white;
            padding: 15px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .question-box {
            padding: 20px;
            background-color: #fff3e0;
            border: 2px solid #ffe0b2;
            border-radius: 8px;
            margin-top: 15px;
            text-align: left;
        }
        #reset-btn {
            display: block;
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background-color: #757575;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <h1>ç”Ÿæ…‹ç³»çµ±ï¼šé£Ÿç‰©éˆæ¨¡æ“¬å™¨</h1>
    
    <div class="food-chain-diagram">
        ç”Ÿç”¢è€… (è‰) &longrightarrow; åˆç´šæ¶ˆè²»è€… (å…”å­) &longrightarrow; æ¬¡ç´šæ¶ˆè²»è€… (ç‹ç‹¸)
    </div>

    

    <div class="container">
        <div id="controls">
            <h2>ç”Ÿæ…‹ç³»çµ±æ§åˆ¶å°</h2>
            <p class="instruction">è«‹é»æ“ŠæŒ‰éˆ•ä¾†æ”¹è®Šç”Ÿç‰©ç¨®ç¾¤æ•¸é‡ï¼š</p>
            <div id="population-status"></div>
        </div>

        <div id="trends">
            <h2>ç”Ÿæ…‹å½±éŸ¿è¶¨å‹¢</h2>
            <div id="trend-display"></div>
            <button id="reset-btn" onclick="resetSimulation()">é‡è¨­æ¨¡æ“¬ç³»çµ±</button>
        </div>
    </div>

    <div id="bottom-controls">
        <button id="brainteaser-button" onclick="showBrainteaser()">
            ğŸ’¡ è…¦ç­‹æ€¥è½‰å½ï¼šåœ¨ç¾å¯¦çš„å¤§è‡ªç„¶ä¸­ï¼Œç‚ºä»€éº¼ç‹ç‹¸ï¼ˆæ¬¡ç´šæ¶ˆè²»è€…ï¼‰çš„æ•¸é‡ç¸½æ˜¯æ¯”è‰ï¼ˆç”Ÿç”¢è€…ï¼‰å°‘å¾—å¤šï¼Ÿï¼Ÿ
        </button>
        <div id="brainteaser-output"></div>
    </div>

    <script>
        const LEVELS = ['ç”Ÿç”¢è€…', 'åˆç´šæ¶ˆè²»è€…', 'æ¬¡ç´šæ¶ˆè²»è€…'];
        const ORGANISMS = {
            'ç”Ÿç”¢è€…': 'è‰', 
            'åˆç´šæ¶ˆè²»è€…': 'å…”å­', 
            'æ¬¡ç´šæ¶ˆè²»è€…': 'ç‹ç‹¸'
        };
        
        let populations = {
            'ç”Ÿç”¢è€…': 80, 
            'åˆç´šæ¶ˆè²»è€…': 50, 
            'æ¬¡ç´šæ¶ˆè²»è€…': 20
        };
        
        const MAX_POPULATION = 100;
        const CLICK_SIZE = 15;
        const CASCADE_SIZE = 8;

        function renderStatus() {
            const statusDiv = document.getElementById('population-status');
            statusDiv.innerHTML = '';
            
            LEVELS.forEach(level => {
                const div = document.createElement('div');
                div.className = 'level';
                div.innerHTML = `
                    <h3>${level} (${ORGANISMS[level]})</h3>
                    <div class="buttons">
                        <button class="increase" onclick="userChangePopulation('${level}', ${CLICK_SIZE})">å¢åŠ æ•¸é‡ â†‘</button>
                        <button class="decrease" onclick="userChangePopulation('${level}', -${CLICK_SIZE})">æ¸›å°‘æ•¸é‡ â†“</button>
                    </div>
                `;
                statusDiv.appendChild(div);
            });
            displayInitialStatus();
        }

        function userChangePopulation(level, delta) {
            populations[level] = Math.max(0, Math.min(MAX_POPULATION, populations[level] + delta)); 
            calculateAndApplyCascade(level, delta); 
        }

        function updatePopulation(level, delta) {
            populations[level] = Math.max(0, Math.min(MAX_POPULATION, populations[level] + delta));
        }

        function calculateAndApplyCascade(changedLevel, delta) {
            const trendDiv = document.getElementById('trend-display');
            trendDiv.innerHTML = '<h3>é€£é–åæ‡‰åˆ†æï¼š</h3>'; 

            const changedIndex = LEVELS.indexOf(changedLevel);
            const changeDirection = delta > 0 ? 1 : -1;
            
            LEVELS.forEach((level, targetIndex) => {
                let trendText = "";
                let reason = "";
                let trendClass = "";
                let effectDirection = 0;

                if (level === changedLevel) {
                    trendText = delta > 0 ? "è¢«æ‰‹å‹•å¢åŠ " : "è¢«æ‰‹å‹•æ¸›å°‘";
                    reason = "äººç‚ºå› ç´ å¹²æ“¾";
                    trendClass = delta > 0 ? "up" : "down";
                } else {
                    const difference = targetIndex - changedIndex;
                    
                    if (difference > 0) { // å°é£Ÿç‰©éˆå¾Œç«¯çš„å½±éŸ¿ (ä¸‹è¡Œ)
                        effectDirection = changeDirection;
                        reason = changeDirection > 0 ? "é£Ÿç‰©å¢åŠ " : "é£Ÿç‰©çŸ­ç¼º";
                    } else { // å°é£Ÿç‰©éˆå‰ç«¯çš„å½±éŸ¿ (ä¸Šè¡Œ)
                        if (Math.abs(difference) === 1) {
                            effectDirection = -changeDirection;
                            reason = effectDirection > 0 ? "æ•é£Ÿè€…æ¸›å°‘" : "æ•é£Ÿè€…å¢åŠ ";
                        } else {
                            // ä¿®æ”¹è™•ï¼šå°‡ã€Œç”Ÿæ…‹å¹³è¡¡é€£é–åæ‡‰ã€æ”¹ç‚ºå‹•æ…‹é¡¯ç¤ºã€Œæ•é£Ÿè€…æ¸›å°‘/å¢åŠ ã€
                            effectDirection = changeDirection;
                            reason = changeDirection > 0 ? "æ•é£Ÿè€…æ¸›å°‘" : "æ•é£Ÿè€…å¢åŠ ";
                        }
                    }

                    if (effectDirection !== 0) {
                        updatePopulation(level, effectDirection * CASCADE_SIZE);
                        trendText = effectDirection > 0 ? "ä¸Šå‡" : "ä¸‹é™";
                        trendClass = effectDirection > 0 ? "up" : "down";
                    }
                }

                const currentPop = populations[level];
                const percentage = (currentPop / MAX_POPULATION) * 100;
                const p = document.createElement('p');
                p.innerHTML = `
                    <span><strong>${level}(${ORGANISMS[level]})</strong> çš„æ•¸é‡ <strong class="${trendClass}">${trendText}</strong></span>
                    <small>åŸå› ï¼š${reason}</small>
                    <div class="population-meter"><div class="bar" style="width: ${percentage}%;"></div></div>
                `;
                trendDiv.appendChild(p);
            });
        }

        function displayInitialStatus() {
            const trendDiv = document.getElementById('trend-display');
            trendDiv.innerHTML = '<h3>ç•¶å‰ç”Ÿæ…‹ç‹€æ…‹ï¼š</h3>';
            LEVELS.forEach(level => {
                const percentage = (populations[level] / MAX_POPULATION) * 100;
                const p = document.createElement('p');
                p.innerHTML = `
                    <span><strong>${level}</strong> ç‹€æ…‹ç©©å®š</span>
                    <div class="population-meter"><div class="bar" style="width: ${percentage}%;"></div></div>
                `;
                trendDiv.appendChild(p);
            });
        }

        function showBrainteaser() {
            const outputDiv = document.getElementById('brainteaser-output');
            outputDiv.innerHTML = `
                <div class="question-box">
                    <h3>ğŸ’¡ ç§‘å­¸æŒ‘æˆ°ï¼šèƒ½é‡æµå‹•</h3>
                    <p>åœ¨ç¾å¯¦çš„å¤§è‡ªç„¶ä¸­ï¼Œç‚ºä»€éº¼ç‹ç‹¸ï¼ˆæ¬¡ç´šæ¶ˆè²»è€…ï¼‰çš„æ•¸é‡ç¸½æ˜¯æ¯”è‰ï¼ˆç”Ÿç”¢è€…ï¼‰å°‘å¾—å¤šï¼Ÿ</p>
                    <ul>
                        <li><strong>èƒ½é‡æµå¤±ï¼š</strong> ç•¶èƒ½é‡å¾ä¸€ç´šå‚³åˆ°ä¸‹ä¸€ç´šæ™‚ï¼Œå¤§ç´„åªæœ‰ <strong>10%</strong> èƒ½å‚³éä¸‹å»ã€‚</li>
                        <li><strong>å»å‘ä½•æ–¹ï¼Ÿ</strong> ç”Ÿç‰©æœƒé€é<strong>å‘¼å¸ä½œç”¨</strong>æ¶ˆè€—èƒ½é‡ï¼Œä¹Ÿæœƒä»¥<strong>ç†±èƒ½</strong>å½¢å¼æ•£å¤±åˆ°ç’°å¢ƒä¸­ã€‚</li>
                        <li><strong>çµè«–ï¼š</strong> é£Ÿç‰©éˆè¶Šå¾€ä¸Šï¼Œå¯ç”¨çš„èƒ½é‡å°±è¶Šå°‘ï¼Œå› æ­¤èƒ½é¤Šæ´»çš„ç”Ÿç‰©æ•¸é‡ä¹Ÿè¶Šå°‘ã€‚</li>
                    </ul>
                    <button onclick="resetBrainteaserSection()" style="padding:5px 10px; cursor:pointer;">éš±è—ç­”æ¡ˆ</button>
                </div>
            `;
            document.getElementById('brainteaser-button').style.display = 'none';
        }

        function resetBrainteaserSection() {
            document.getElementById('brainteaser-output').innerHTML = '';
            document.getElementById('brainteaser-button').style.display = 'inline-block';
        }

        function resetSimulation() {
            populations = { 'ç”Ÿç”¢è€…': 80, 'åˆç´šæ¶ˆè²»è€…': 50, 'æ¬¡ç´šæ¶ˆè²»è€…': 20 };
            renderStatus();
            resetBrainteaserSection();
            alert('æ¨¡æ“¬ç³»çµ±å·²é‡ç½®ç‚ºå¹³è¡¡ç‹€æ…‹ã€‚');
        }

        window.onload = renderStatus;
    </script>
</body>
</html>